<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">AppState | Smart Contracts</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://sigmadex.github.io/v0-proto/docs/Api Specification/libraries/AppState"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="AppState | Smart Contracts"><meta data-react-helmet="true" name="description" content="This page provides an indepth explanation of what state is tracked in the contract to provide its functionality.  We can divide this state into 5 different subsystems."><meta data-react-helmet="true" property="og:description" content="This page provides an indepth explanation of what state is tracked in the contract to provide its functionality.  We can divide this state into 5 different subsystems."><link data-react-helmet="true" rel="shortcut icon" href="/v0-proto/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://sigmadex.github.io/v0-proto/docs/Api Specification/libraries/AppState"><link data-react-helmet="true" rel="alternate" href="https://sigmadex.github.io/v0-proto/docs/Api Specification/libraries/AppState" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://sigmadex.github.io/v0-proto/docs/Api Specification/libraries/AppState" hreflang="x-default"><link rel="stylesheet" href="/v0-proto/assets/css/styles.4a07c07f.css">
<link rel="preload" href="/v0-proto/assets/js/runtime~main.68c4984a.js" as="script">
<link rel="preload" href="/v0-proto/assets/js/main.796cdc05.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/v0-proto/"><div class="navbar__logo"><img src="https://i.imgur.com/L7rAsEe.png" alt="Sigmadex" class="themedImage_1VuW themedImage--light_3UqQ"><img src="https://i.imgur.com/PAw3zac.png" alt="Sigmadex" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title"></b></a><a class="navbar__item navbar__link" href="/v0-proto/docs/Introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Sigmadex/v0-proto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AppState</h1></header><p>This page provides an indepth explanation of what state is tracked in the contract to provide its functionality.  We can divide this state into 5 different subsystems.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="sdex-subsystem">Sdex Subsystem<a aria-hidden="true" class="hash-link" href="#sdex-subsystem" title="Direct link to heading">â€‹</a></h3><p>The Sdex Subsystem is responsible for holding the state required to implement the ERC-20 compliant Sdex Token</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> uint256</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> sdexBalances</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// user address maps to amount of Sdex owned</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> uint256</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  sdexAllowances</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//user address allows other address the spending of amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 sdexTotalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//total Amount of Sdex in existance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string sdexName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//name of token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string sdexSymbol</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// symbol of token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint8 sdexDecimals</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// decimals for token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="farm-subsystem">Farm Subsystem<a aria-hidden="true" class="hash-link" href="#farm-subsystem" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="pools">Pools<a aria-hidden="true" class="hash-link" href="#pools" title="Direct link to heading">â€‹</a></h4><p>State concerning the pools are contained within the {PoolInfo} struct. Which are mapped by a unique id in the <code>poolInfo</code> mapping. the <code>poolLength</code> retreives the amount of pools if one wishes to iterate over all of them.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">PoolTokenData</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// An ERC20 interface of a token in a pool, can be LP tokens, Sdex, stables or others</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 supply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// the total amount of this token within this specific pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 accSdexPerShare</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// the amount of accumulated blockrewards since the pools birth per unit supply</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">PoolInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">PoolTokenData</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> tokenData</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Array of PoolTokenDatas, normally of length 1, or 2, but can be many</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 allocPoint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// allocation points, used to determine what proportion of block rewards this pool gets per block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 lastRewardBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// SDEX lazy updates on user input, sometimes many block go by before update, used to catch up state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">uint256</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">PoolInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> poolInfo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// mapping holding all pools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 poolLength </span><span class="token comment" style="color:#999988;font-style:italic">// pool Iterator, max number of pools, used to add another and find an iterator over all pools</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The Farm subsystem also uses these globals across all farms</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">uint256 sdexPerBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// amount of Sdex emitted per block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 </span><span class="token constant" style="color:#36acaa">BONUS_MULTIPLIER</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// sdexPerBlock can be amplified or dampened temporaily by toggling this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 totalAllocPoint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// total amount of farm allocation points, used in determining what proportion of sdex per block a farm receives</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// block where awards start being minted</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="users">Users<a aria-hidden="true" class="hash-link" href="#users" title="Direct link to heading">â€‹</a></h4><p>Data on specific users&#x27; claims within pools is stored through the <code>userInfo</code> mapping.  which takes a <code>poolid</code> and their <code>address</code> and outputs the {UserInfo} object. When a user deposits funds into a pool with <code>poolid</code> a {UserPosition} object is created with a <code>positionid</code>.  This {UserPosition} objects holds the specific deposit data, while the {UserTokenData} object keeps tracks of relevant sum totals of that user in that pool.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">UserPosition</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// block this position was created at</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 endBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// block the user states is the finish of his staking period</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> amounts</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// array of amounts deposited, same length and order as the pools `tokenData`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> rewardDebts</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// tracks users rewards at t-1 to know how much to give next</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  address nftReward</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// the address of the specific NFT reward if applied (address(0)) is no NFT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 nftid</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// the id of the nft at the above address (0 for no NFT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">UserTokenData</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 amount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// sum of all tokens of this type across all open positions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 totalRewardDebt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// sum of all users rewards at t-1 to know what to give next</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">UserInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">UserTokenData</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> tokenData</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// array of {TokenData} same order as pools tokenData</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">UserPosition</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> positions</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// an array of all users created positions in this pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 lastRewardBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// tracks how many blocks to update upon a lazy update initiated by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mapping</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">uint256</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mapping</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">UserInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> userInfo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="vault-subsystem">Vault Subsystem<a aria-hidden="true" class="hash-link" href="#vault-subsystem" title="Direct link to heading">â€‹</a></h3><p>The Vault subsystem is a special &#x27;trading bot&#x27; like system that operates on <code>poolid=0</code>, the SDEX only farm. It exposes deposit withdraw functionality for the end users, and continually reinvests any block rewards on behalf of the users. Like farms, when a user deposits in the vault, a {VaultUserPosition} is created inside their {VaultUserInfo}</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">VaultUserPosition</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// block where the deposit of SDEX occured</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 endBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// When the timestake is over</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 amount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// amount staked</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 shares</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// proportion of ownership of assets in vault, used in calcs as Sdex is compounding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  address nftReward</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// address of applied NFT reward, (address(0) for no NFT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 nftid</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// id of nft at address above, (0 for no NFT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">VaultUserInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 shares</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// number of total shares for a user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 lastDepositedTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// keeps track of deposited time for potential penalty</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 sdexAtLastUserAction</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// keeps track of cake deposited at the last user action</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 lastUserActionTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// keeps track of the last user action time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">VaultUserPosition</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> positions</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// array of positions a user created by depositing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mapping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">VaultUserInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> vUserInfo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// user address maps to the {VaultUserInfo} object</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The Vault also contains the following global state for the <code>harvest</code> functionality.  When compensates users a small amount in exchange for paying for the bot to autocompound everyones shares</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">uint256 vSdex</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//internal count of how much Sdex the bot &#x27;owns&#x27; in the diamond</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 vTotalShares</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// total amount of shares on vault</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 vLastHarvestedTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// last block where the harvest function was executed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 vTreasury</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// an internal account of how much Sdex is collected by the perforance fee</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 vMAX_PERFORMANCE_FEE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 5%, max performance fee that can be set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 vMAX_CALL_FEE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 1% , max call fee that can be set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 vPerformanceFee</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 2% , 2% of pending rewards in the vault are sent to treasury on harvest execution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 vCallFee</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 0.25%, 0.25% of pending rewards in the vault are sent to harvester</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="penalty-pool-subsystem">Penalty Pool Subsystem<a aria-hidden="true" class="hash-link" href="#penalty-pool-subsystem" title="Direct link to heading">â€‹</a></h3><p>The penalty/reward subsystem is responsible, calculating, accounting and distributing penalties and rewards on the platform.  Each token that is listed on the platform has one penalty and reward pool, upon the exception of the SDEX token itself, which additionally has an accumulatedSdex penalty and reward pool respectively.  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 accSdexPenaltyPool</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// amount of Sdex in the AccSdex Penalty Pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 accSdexRewardPool</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// amount of claims outstanding in NFT rewards</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 accSdexPaidOut</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// amount that has been paid out in NFT rewards</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">TokenRewardData</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 blockAmountGlobal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// sum of all blocksStaked*amountStaked for all positions in this token, used to calc amount received from penalty pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 rewarded</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// amount of claims currently outstanding of this token in NFT rewards</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 penalties</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// amount of tokens currently in penalty pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint256 paidOut</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// amount of NFT rewards that have been paid out over all time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mapping</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">TokenRewardData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> tokenRewardData</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="nft-reward-subsystem">NFT Reward Subsystem<a aria-hidden="true" class="hash-link" href="#nft-reward-subsystem" title="Direct link to heading">â€‹</a></h3><p>The reward subsystem concerns acting as a middleware between the NFT rewards, the NFT Reward Facets,  and the Penalty Subsystem</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">struct </span><span class="token maybe-class-name">Reward</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes4 withdrawSelector</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// function signature for an NFT rewards withdraw function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes4 vaultWithdrawSelector</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// function signature for an NFT rewards vault withdraw selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes4 rewardSelector</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// function signature for an NFT rewards&#x27; create reward selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mapping</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Reward</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> rewards</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// nft address to {Reward} router struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mapping</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> validRewards</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// token address maps to nft addresses that can be minted for it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">REWARDPOOL</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">BASE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ACC</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// determines which reward pool the nft pulls its underlying value from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 seed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// number that assists in the pseudo random picking of which nft to mint for reward</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sdex-subsystem" class="table-of-contents__link toc-highlight">Sdex Subsystem</a></li><li><a href="#farm-subsystem" class="table-of-contents__link toc-highlight">Farm Subsystem</a></li><li><a href="#vault-subsystem" class="table-of-contents__link toc-highlight">Vault Subsystem</a></li><li><a href="#penalty-pool-subsystem" class="table-of-contents__link toc-highlight">Penalty Pool Subsystem</a></li><li><a href="#nft-reward-subsystem" class="table-of-contents__link toc-highlight">NFT Reward Subsystem</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/v0-proto/docs/Introduction">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://t.me/SigmadexEN" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Sigmadex" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/Sigmadex" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.sigmadex.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://sigmadex.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sigmadex</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Sigmadex Foundation.</div></div></div></footer></div>
<script src="/v0-proto/assets/js/runtime~main.68c4984a.js"></script>
<script src="/v0-proto/assets/js/main.796cdc05.js"></script>
</body>
</html>