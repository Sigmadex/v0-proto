<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">Token Farm | Smart Contracts</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://sigmadex.github.io/v0-proto/docs/System Overview/Token Farm"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Token Farm | Smart Contracts"><meta data-react-helmet="true" name="description" content="The TokenFarm comprises the majority of V0 functionality.  Users interact with the deposit and withdraw functions found in TokenFarmFacet, when they do, the following things happen.  Firstly, the farm in question is updated with the update function in ToolShedFacet. This mints the Sdex for the block and calculates how much of the Sdex is alotted to this pool in question.  It than updates the  {TokenData} accSdexPerShare which counts the accumulated Sdex of that pool per every unit of token provided for it. a {UserPosition}  is than created according to the depositors parameters that is stored in the {UserInfo} {UserPositions} array of that user. For each token in the pool, the blocksStaked times the stakedAmount is added to the {RewardGlobals} to keep track of the proportion of rewards at the end."><meta data-react-helmet="true" property="og:description" content="The TokenFarm comprises the majority of V0 functionality.  Users interact with the deposit and withdraw functions found in TokenFarmFacet, when they do, the following things happen.  Firstly, the farm in question is updated with the update function in ToolShedFacet. This mints the Sdex for the block and calculates how much of the Sdex is alotted to this pool in question.  It than updates the  {TokenData} accSdexPerShare which counts the accumulated Sdex of that pool per every unit of token provided for it. a {UserPosition}  is than created according to the depositors parameters that is stored in the {UserInfo} {UserPositions} array of that user. For each token in the pool, the blocksStaked times the stakedAmount is added to the {RewardGlobals} to keep track of the proportion of rewards at the end."><link data-react-helmet="true" rel="shortcut icon" href="/v0-proto/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://sigmadex.github.io/v0-proto/docs/System Overview/Token Farm"><link data-react-helmet="true" rel="alternate" href="https://sigmadex.github.io/v0-proto/docs/System Overview/Token Farm" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://sigmadex.github.io/v0-proto/docs/System Overview/Token Farm" hreflang="x-default"><link rel="stylesheet" href="/v0-proto/assets/css/styles.2dc225a2.css">
<link rel="preload" href="/v0-proto/assets/js/runtime~main.6adb073d.js" as="script">
<link rel="preload" href="/v0-proto/assets/js/main.0b1daf27.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/v0-proto/"><div class="navbar__logo"><img src="/v0-proto/img/sigmadex-logo.png" alt="Sigmadex" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/v0-proto/img/sigmadex-logo.png" alt="Sigmadex" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/v0-proto/docs/Introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Sigmadex/v0-proto" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v0-proto/docs/Introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Protocol Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">System Overview</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0-proto/docs/System Overview/System Overview">System Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0-proto/docs/System Overview/Diamond">Diamond</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0-proto/docs/System Overview/Sdex">Sdex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/v0-proto/docs/System Overview/Token Farm">Token Farm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0-proto/docs/System Overview/Vault">Vault</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Rewards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0-proto/docs/System Overview/Governance">Governance</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Api Reference</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="theme-doc-markdown markdown"><header><h1>Token Farm</h1></header><p>The TokenFarm comprises the majority of V0 functionality.  Users interact with the deposit and withdraw functions found in <a href="/v0-proto/docs/Api Specification/facets/TokenFarmFacet">TokenFarmFacet</a>, when they do, the following things happen.  Firstly, the farm in question is updated with the update function in <a href="/v0-proto/docs/Api Specification/facets/ToolShedFacet#updatePool">ToolShedFacet</a>. This mints the Sdex for the block and calculates how much of the Sdex is alotted to this pool in question.  It than updates the {PoolInfo} {TokenData} <code>accSdexPerShare</code> which counts the accumulated Sdex of that pool per every unit of token provided for it. a {UserPosition}  is than created according to the depositors parameters that is stored in the {UserInfo} {UserPositions} array of that user. For each token in the pool, the blocksStaked times the stakedAmount is added to the {RewardGlobals} to keep track of the proportion of rewards at the end. </p><p>When the &#x27;withdraw&#x27; function is called. it firsts checks to see if the {UserPosition} has an nft applied, if so, the function is highjacked by the {RewardFacets} version of the function to implement the custom logic that lands up doleing out the rewards.  Otherwise the system than checks if the <code>block.number</code> is before or after the <code>endBlock</code> of the {UserPosition} to see if a premature withdrawal is occuring.</p><p>If the function is a premature withdraw, the <code>calcRefund</code> function in <a href="/v0-proto/docs/Api Specification/facets/ToolShedFacet#calcrefund">ToolShedFacet</a>. is executed to determine how much is refunded to the user for that token, and how much is sent to the penalty pool for future rewards.  For V0 this function is rather intense, starting with a 100% penalty, linearlly decreasing to 0% at <code>timeEnd</code>, in future versions we have a different algorithm in mind all together.  In this event, any SDEX that has been accrued by the position is also transferred to the accruedSdexPenalty pool.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>While a proportion of your staked tokens are return based on the % time ones completed of their commitment, 100% of all accrued Sdex are penalty pooled in the case of a premature withdraw</p></div></div><p>In the case a user is withdrawing after thier <code>endBlock</code> not only is 100% of each of the staked tokens and 100% of the accrued SDEX is returned.  But the each staked tokens&#x27; blocksStaked and amount is multiplied together and sent to the <a href="/v0-proto/docs/Api Specification/facets/RewardFacet#requestreward">RewardFacet</a>&#x27;s <code>requestReward</code> function.  This function calculates what proportion of the penalty pool of that token the user receives in their NFT reward.  After the amount is calculated.  It is sent to the <a href="/v0-proto/docs/Api Specification/facets/RewardFacet#mintreward"><code>mintReward</code></a> function which is tasked with <em>Pseudorandomly</em> choosing which NFT to mint for that token out of the list of {ValidRewardsForToken} list.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>v0 uses a pseudorandom function generator to determine exactly which NFT is minted for the user.  Savvy individuals will be able to &#x27;hack&#x27; this value to obtain their desired one.  Future Sigmadex versions will provide much better randomness through the <a href="https://docs.chain.link/docs/chainlink-vrf/" target="_blank" rel="noopener noreferrer">Chainlink VRF</a></p></div></div><p>As no function overlapped are permitted in the Diamond Architecture, the reward function than delegates minting by function signature to the NFT reward to be created for the User.</p><p>Additionally, an Sdex NFT reward is also minted for the user.  Since it was accrued SDEX the TokenFarm calls the <a href="/v0-proto/docs/Api Specification/facets/RewardFacet#requestsdexreward"><code>requestSdexReward</code></a></p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>The native token SDEX, has two separate penalty pools, one that acts like a normal tokens&#x27; penalty pool, and a special one for accrued SDEX. If you stake SDEX like a normal token, you pick from the first pool, if the reward comes from block rewards, it takes from this special pool</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/v0-proto/docs/System Overview/Sdex"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Sdex</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/v0-proto/docs/System Overview/Vault"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Vault<!-- --> Â»</div></a></div></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/v0-proto/docs/Introduction">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://t.me/SigmadexEN" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/sigmadex" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/Sigmadex" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.sigmadex.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://sigmadex.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sigmadex</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Sigmadex, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/v0-proto/assets/js/runtime~main.6adb073d.js"></script>
<script src="/v0-proto/assets/js/main.0b1daf27.js"></script>
</body>
</html>